@import "tailwindcss";

@theme {
  /* Light theme colors (default) */
  --color-background: oklch(100% 0 0);
  --color-foreground: oklch(9.8% 0.041 222.2);

  --color-primary: oklch(22.4% 0.053 222.2);
  --color-primary-foreground: oklch(98% 0.04 210);

  --color-secondary: oklch(96.1% 0.04 210);
  --color-secondary-foreground: oklch(22.4% 0.053 222.2);

  --color-muted: oklch(96.1% 0.04 210);
  --color-muted-foreground: oklch(57.5% 0.025 215.4);

  --color-accent: oklch(96.1% 0.04 210);
  --color-accent-foreground: oklch(22.4% 0.053 222.2);

  --color-border: oklch(91.4% 0.032 214.3);
  --color-input: oklch(91.4% 0.032 214.3);
  --color-ring: oklch(9.8% 0.041 222.2);

  --radius-lg: 0.5rem;
  --radius-md: calc(0.5rem - 2px);
  --radius-sm: calc(0.5rem - 4px);

  /* Typography — driven at runtime by ThemeManager */
  --typography-font-family: system-ui, sans-serif;
  --typography-font-size: 14px;
  --typography-line-height: 1.5;

  /* Spacing scale (unitless multiplier, applied in ThemeManager) */
  --spacing-scale: 1;

  /* Icon size */
  --icon-size: 16px;
}

:root[class~="dark"] {
  /* Dark theme colors */
  --color-background: oklch(9.8% 0.041 222.2);
  --color-foreground: oklch(98% 0.04 210);

  --color-primary: oklch(98% 0.04 210);
  --color-primary-foreground: oklch(22.4% 0.053 222.2);

  --color-secondary: oklch(30.3% 0.033 217.2);
  --color-secondary-foreground: oklch(98% 0.04 210);

  --color-muted: oklch(30.3% 0.033 217.2);
  --color-muted-foreground: oklch(72.3% 0.026 215);

  --color-accent: oklch(30.3% 0.033 217.2);
  --color-accent-foreground: oklch(98% 0.04 210);

  --color-border: oklch(30.3% 0.033 217.2);
  --color-input: oklch(30.3% 0.033 217.2);
  --color-ring: oklch(88.2% 0.027 212.7);
}

* {
  border-color: var(--color-border);
}

body {
  background-color: var(--color-background);
  color: var(--color-foreground);
  font-family: var(--typography-font-family);
  font-size: var(--typography-font-size);
  line-height: var(--typography-line-height);
}

/* ── View hook display helpers (kn-view-*) ──────────────────────────────────
   These classes are used by HTML generated from Rhai on_view hooks.
   They are defined here (not as Tailwind utilities) so that dynamically-
   generated HTML can reference them without relying on JIT class scanning.
   ─────────────────────────────────────────────────────────────────────────── */

.kn-view-table           { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
.kn-view-th              { text-align: left; color: var(--color-muted-foreground);
                           font-weight: 500; padding: 0 1rem 0.5rem 0;
                           border-bottom: 1px solid var(--color-border); }
.kn-view-td              { padding: 0.35rem 1rem 0.35rem 0; vertical-align: top; }
.kn-view-tr:hover .kn-view-td { background-color: var(--color-secondary); }

.kn-view-section         { margin-bottom: 1.25rem; }
.kn-view-section-title   { font-size: 0.7rem; font-weight: 600; text-transform: uppercase;
                           letter-spacing: 0.06em; color: var(--color-muted-foreground);
                           margin-bottom: 0.5rem; }

.kn-view-stack           { display: flex; flex-direction: column; gap: 0.75rem; }
.kn-view-columns         { display: grid; gap: 1rem; }

/* Shared grid for default view field lists — all labels share one column track */
.kn-view-fields          { display: grid; grid-template-columns: auto 1fr;
                           column-gap: 1.5rem; row-gap: 0.15rem;
                           margin: 0; padding: 0; list-style: none; }

/* Each field row used by custom on_view scripts keeps its own per-row grid */
.kn-view-field-row       { display: grid; grid-template-columns: auto 1fr;
                           gap: 0 1.5rem; margin-bottom: 0.15rem; }

.kn-view-field-label     { font-size: 0.875rem; font-weight: 500;
                           color: var(--color-muted-foreground); white-space: nowrap; }
.kn-view-field-value     { font-size: 0.875rem; color: var(--color-foreground); margin: 0; }

.kn-view-heading         { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.4rem; }
.kn-view-text            { white-space: pre-wrap; word-break: break-words;
                           font-size: 0.875rem; }

.kn-view-list            { list-style-type: disc; padding-left: 1.25rem;
                           font-size: 0.875rem; }
.kn-view-list li         { margin-bottom: 0.2rem; }

.kn-view-divider         { border: none; border-top: 1px solid var(--color-border);
                           margin: 1rem 0; }

.kn-view-badge           { display: inline-flex; align-items: center;
                           padding: 0.1rem 0.5rem; border-radius: 9999px;
                           font-size: 0.7rem; font-weight: 500;
                           background-color: var(--color-secondary);
                           color: var(--color-secondary-foreground); }

/* Colored badge variants — light-mode values; dark overrides below */
.kn-view-badge-red    { background-color: #fee2e2; color: #b91c1c; }
.kn-view-badge-green  { background-color: #dcfce7; color: #15803d; }
.kn-view-badge-blue   { background-color: #dbeafe; color: #1d4ed8; }
.kn-view-badge-yellow { background-color: #fef9c3; color: #a16207; }
.kn-view-badge-gray   { background-color: #f3f4f6; color: #374151; }
.kn-view-badge-orange { background-color: #ffedd5; color: #c2410c; }
.kn-view-badge-purple { background-color: #f3e8ff; color: #7e22ce; }

:root[class~="dark"] .kn-view-badge-red    { background-color: #7f1d1d; color: #fca5a5; }
:root[class~="dark"] .kn-view-badge-green  { background-color: #14532d; color: #86efac; }
:root[class~="dark"] .kn-view-badge-blue   { background-color: #1e3a5f; color: #93c5fd; }
:root[class~="dark"] .kn-view-badge-yellow { background-color: #713f12; color: #fde68a; }
:root[class~="dark"] .kn-view-badge-gray   { background-color: #1f2937; color: #d1d5db; }
:root[class~="dark"] .kn-view-badge-orange { background-color: #7c2d12; color: #fdba74; }
:root[class~="dark"] .kn-view-badge-purple { background-color: #3b0764; color: #d8b4fe; }

/* Note navigation link generated by link_to() */
.kn-view-link           { color: var(--color-primary); cursor: pointer;
                          text-decoration: underline; }
.kn-view-link:hover     { opacity: 0.8; }

/* Back button shown above view content when navigation history is non-empty */
.kn-view-back           { padding: 0.25rem 0; margin-bottom: 0.75rem; }
.kn-view-back button    { background: none; border: none; cursor: pointer;
                          color: var(--color-primary); font-size: 0.875rem;
                          padding: 0; }
.kn-view-back button:hover { opacity: 0.8; }

/* Markdown-rendered textarea content ────────────────────────────────────── */
/* Scoped under .kn-view-markdown so generated element styles (h1, p, ul…)  */
/* do not bleed into surrounding UI.                                          */

.kn-view-markdown                  { font-size: 0.875rem; line-height: 1.6; }
.kn-view-markdown p                { margin: 0 0 0.5rem 0; }
.kn-view-markdown p:last-child     { margin-bottom: 0; }
.kn-view-markdown h1               { font-size: 1.2rem; font-weight: 700; margin: 0.75rem 0 0.3rem; }
.kn-view-markdown h2               { font-size: 1.05rem; font-weight: 600; margin: 0.65rem 0 0.25rem; }
.kn-view-markdown h3               { font-size: 0.95rem; font-weight: 600; margin: 0.5rem 0 0.2rem; }
.kn-view-markdown h4,
.kn-view-markdown h5,
.kn-view-markdown h6               { font-size: 0.875rem; font-weight: 600; margin: 0.4rem 0 0.15rem; }
.kn-view-markdown ul               { list-style-type: disc; padding-left: 1.25rem; margin: 0.25rem 0; }
.kn-view-markdown ol               { list-style-type: decimal; padding-left: 1.25rem; margin: 0.25rem 0; }
.kn-view-markdown li               { margin-bottom: 0.15rem; }
.kn-view-markdown li > p           { margin: 0; }
.kn-view-markdown pre              { background: var(--color-secondary);
                                     border-radius: var(--radius-sm);
                                     padding: 0.5rem 0.75rem; font-size: 0.8rem;
                                     overflow-x: auto; margin: 0.4rem 0; }
.kn-view-markdown code             { font-family: ui-monospace, SFMono-Regular, monospace;
                                     font-size: 0.85em;
                                     background: var(--color-secondary);
                                     border-radius: var(--radius-sm);
                                     padding: 0.1rem 0.3rem; }
.kn-view-markdown pre code         { background: transparent; padding: 0; font-size: inherit; }
.kn-view-markdown blockquote       { border-left: 3px solid var(--color-border);
                                     margin: 0.4rem 0; padding: 0.1rem 0.75rem;
                                     color: var(--color-muted-foreground); }
.kn-view-markdown strong           { font-weight: 600; }
.kn-view-markdown em               { font-style: italic; }
.kn-view-markdown del              { text-decoration: line-through; }
.kn-view-markdown hr               { border: none;
                                     border-top: 1px solid var(--color-border);
                                     margin: 0.75rem 0; }
.kn-view-markdown a                { color: var(--color-primary); text-decoration: underline; }
.kn-view-markdown table            { width: 100%; border-collapse: collapse;
                                     margin: 0.4rem 0; font-size: 0.875rem; }
.kn-view-markdown th               { text-align: left; font-weight: 500;
                                     color: var(--color-muted-foreground);
                                     padding: 0 0.75rem 0.35rem 0;
                                     border-bottom: 1px solid var(--color-border); }
.kn-view-markdown td               { padding: 0.25rem 0.75rem 0.25rem 0;
                                     vertical-align: top; }
.kn-view-section--legacy        { margin-top: 0.75rem; }

/* ── Tag pills ───────────────────────────────────────────────────────────── */
.kn-tag-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
  color: #333;
  white-space: nowrap;
  user-select: none;
}
.kn-tag-pill--clickable {
  cursor: pointer;
}
.kn-tag-pill--clickable:hover {
  filter: brightness(0.93);
}
.kn-tag-pill__remove {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  font-size: 0.9rem;
  line-height: 1;
  color: #555;
  display: flex;
  align-items: center;
}
.kn-tag-pill__remove:hover {
  color: #000;
}
.kn-view-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 12px;
}

/* ── Tag editor ─────────────────────────────────────────────────────────── */
.kn-tag-editor {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 16px;
}
.kn-tag-editor__pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.kn-tag-editor__input-wrap {
  position: relative;
}
.kn-tag-editor__input {
  width: 100%;
  padding: 4px 8px;
  font-size: 0.85rem;
  border: 1px solid var(--color-border, #ccc);
  border-radius: 6px;
  background: var(--color-background, #fff);
  color: var(--color-foreground);
  box-sizing: border-box;
}
.kn-tag-editor__suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--color-popover, #fff);
  border: 1px solid var(--color-border, #ccc);
  border-radius: 6px;
  list-style: none;
  margin: 2px 0 0;
  padding: 4px 0;
  z-index: 100;
  max-height: 180px;
  overflow-y: auto;
}
.kn-tag-editor__suggestions li {
  padding: 4px 10px;
  cursor: pointer;
  font-size: 0.85rem;
}
.kn-tag-editor__suggestions li:hover {
  background: var(--color-secondary, #f0f0f0);
}

/* ── Tag cloud ──────────────────────────────────────────────────────────── */
.kn-tag-divider {
  height: 4px;
  cursor: row-resize;
  background: var(--color-border, #e0e0e0);
  flex-shrink: 0;
}
.kn-tag-divider:hover {
  background: var(--color-muted-foreground, #bbb);
}
.kn-tag-cloud {
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  gap: 6px;
  padding: 8px;
  flex-shrink: 0;
}
.kn-tag-cloud__empty {
  font-size: 0.75rem;
  color: var(--color-muted-foreground, #999);
}

/* ── Hover Tooltip ──────────────────────────────────────────────────────── */

.kn-hover-tooltip {
  position: fixed;
  z-index: 200;
  max-width: 280px;
  min-width: 160px;
  padding: 10px 12px;
  border-radius: 8px;
  background: var(--color-secondary);
  border: 1px solid var(--color-border);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.35);
  font-size: 0.8125rem;
  line-height: 1.5;
  pointer-events: none;
  animation: kn-tooltip-in 120ms ease-out;
}

@keyframes kn-tooltip-in {
  from { opacity: 0; transform: translateX(4px); }
  to   { opacity: 1; transform: translateX(0); }
}

/* Left-pointing spike — two layered triangles to simulate a border */
.kn-hover-tooltip::before {
  content: '';
  position: absolute;
  left: -8px;
  top: var(--spike-offset, 50%);
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 7px solid transparent;
  border-bottom: 7px solid transparent;
  border-right: 8px solid var(--color-border);
}

.kn-hover-tooltip::after {
  content: '';
  position: absolute;
  left: -6px;
  top: var(--spike-offset, 50%);
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 7px solid var(--color-secondary);
}

.kn-hover-tooltip__row {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 4px 10px;
  align-items: baseline;
}

.kn-hover-tooltip__label {
  color: var(--color-muted-foreground);
  font-size: 0.75rem;
  white-space: nowrap;
}

.kn-hover-tooltip__value {
  color: var(--color-foreground);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 180px;
}
